---
phase: 02-product-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [config/database.php, products/index.php, database/products_schema.sql]
autonomous: true
requirements: [PROD-01, PROD-05]

must_haves:
  truths:
    - "Products table exists with proper schema"
    - "Database connection configured for products module"
    - "Price uses DECIMAL(10,2), stock uses INT UNSIGNED"
    - "CHECK constraints prevent negative stock and price"
    - "Products list page accessible and shows table structure"
  artifacts:
    - path: "database/products_schema.sql"
      provides: "Product table schema with constraints"
      contains: "CREATE TABLE products"
    - path: "config/database.php"
      provides: "Database connection (already exists, may need verification)"
      exports: ["$conn"]
    - path: "products/index.php"
      provides: "Product list page stub with table HTML structure"
      min_lines: 20
  key_links:
    - from: "products/index.php"
      to: "config/database.php"
      via: "require_once include"
      pattern: "require_once.*config/database\\.php"
    - from: "database/products_schema.sql"
      to: "MySQL products table"
      via: "SQL execution"
      pattern: "CREATE TABLE products"
---

<objective>
Set up database schema for products table and create empty product list page structure.

Purpose: Establish the foundation for all CRUD operations with proper data types and constraints that prevent invalid data at the database level.

Output: SQL schema file, verified database connection, empty products list page ready for DataTables integration.
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
@./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-product-management/02-RESEARCH.md
@.planning/phases/02-product-management/02-CONTEXT.md
@config/database.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create products table schema with constraints</name>
  <files>database/products_schema.sql</files>
  <action>
    Create SQL schema file with products table following research specifications:
    
    - id: INT UNSIGNED AUTO_INCREMENT PRIMARY KEY
    - sku: VARCHAR(50) UNIQUE (optional, can be NULL)
    - name: VARCHAR(255) NOT NULL
    - price: DECIMAL(10,2) NOT NULL DEFAULT 0.00 (NEVER FLOAT)
    - cost: DECIMAL(10,2) DEFAULT 0.00 (for profit calculation)
    - stock: INT UNSIGNED NOT NULL DEFAULT 0
    - min_stock: INT UNSIGNED DEFAULT 10 (low stock threshold)
    - category: VARCHAR(100)
    - unit: VARCHAR(20) DEFAULT 'pcs'
    - is_active: TINYINT(1) NOT NULL DEFAULT 1
    - created_at: TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    - updated_at: TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
    
    Add CHECK constraints (MySQL 8.0+):
    - CONSTRAINT chk_price_positive CHECK (price >= 0)
    - CONSTRAINT chk_stock_non_negative CHECK (stock >= 0)
    
    Add indexes:
    - INDEX idx_name (name)
    - INDEX idx_category (category)
    - INDEX idx_is_active (is_active)
    
    Use ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
    
    After creating schema file, execute it against the database using MySQL CLI or import tool.
  </action>
  <verify>
    Run: mysql -u root mini_cashier < database/products_schema.sql
    Then verify: SHOW CREATE TABLE products; shows all columns and constraints
  </verify>
  <done>
    Products table exists with DECIMAL(10,2) for price, INT UNSIGNED for stock, CHECK constraints preventing negative values, and appropriate indexes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify database connection and create products directory structure</name>
  <files>config/database.php, products/index.php</files>
  <action>
    1. Verify config/database.php exists and works (from Phase 1)
    2. Create products/ directory if it doesn't exist
    3. Create products/index.php with basic structure:
       - Include session_config.php, auth_check.php, role_check.php (admin only)
       - Include header.php, sidebar.php, footer.php
       - Add page title "Manajemen Produk"
       - Add empty container div for product table
       - Add "Tambah Produk" button linking to create.php (will be created in Plan 03)
    
    This is a stub file - DataTables integration happens in Plan 02.
  </action>
  <verify>
    Visit http://localhost/mini-cashier/products/index.php while logged in as admin
    Page loads without errors, shows header, sidebar, and empty content area
  </verify>
  <done>
    Products directory exists, index.php accessible to admin role only, basic page structure in place with proper includes.
  </done>
</task>

</tasks>

<verification>
- Products table schema file exists and has been executed
- SHOW TABLES shows 'products' table
- DESCRIBE products shows correct column types (DECIMAL for price, INT UNSIGNED for stock)
- SHOW CREATE TABLE products shows CHECK constraints
- products/index.php loads without errors for admin users
- Non-admin users redirected or shown access denied
</verification>

<success_criteria>
- Database schema complete with all constraints
- Products table ready for CRUD operations
- Empty product list page structure in place
- All files follow Phase 1 patterns (includes, session config, auth checks)
</success_criteria>

<output>
After completion, create `.planning/phases/02-product-management/02-01-SUMMARY.md` with:
- Schema creation confirmation
- Table structure details
- Any issues encountered during setup
</output>
