---
phase: 02-product-management
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [products/index.php, includes/header.php]
autonomous: true
requirements: [PROD-01]

must_haves:
  truths:
    - "Product list displays all products in table format"
    - "Table shows: ID, Name, Category, Price, Stock, Unit, Status, Actions"
    - "Low stock items (≤10) show visual warning badge"
    - "Table has sorting, pagination, and search functionality"
    - "Edit and Delete buttons present for each product row"
  artifacts:
    - path: "products/index.php"
      provides: "Full product list with DataTables"
      min_lines: 80
    - path: "includes/header.php"
      provides: "CDN links for Bootstrap 5, DataTables, jQuery"
      contains: "DataTables CSS and JS includes"
  key_links:
    - from: "products/index.php"
      to: "includes/header.php"
      via: "PHP include"
      pattern: "include.*header\\.php"
    - from: "products/index.php"
      to: "config/database.php"
      via: "require_once for DB connection"
      pattern: "require_once.*database\\.php"
    - from: "products/index.php"
      to: "DataTables CDN"
      via: "jQuery initialization"
      pattern: "\\$\\('#?products?Table'?\\)\\.DataTable"
---

<objective>
Implement product list page with DataTables for sorting, pagination, and search functionality.

Purpose: Provide admin with a clear, interactive view of all products with low stock warnings and quick access to edit/delete actions.

Output: Fully functional product list with DataTables integration, low stock indicators, and action buttons.
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
@./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/02-product-management/02-RESEARCH.md
@.planning/phases/02-product-management/02-CONTEXT.md
@products/index.php
@includes/header.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add DataTables and Bootstrap 5 CDN to header</name>
  <files>includes/header.php</files>
  <action>
    Update header.php to include DataTables 2.x dependencies via CDN:
    
    In <head> section (after Bootstrap CSS):
    - DataTables Bootstrap 5 CSS: https://cdn.datatables.net/2.0.0/css/dataTables.bootstrap5.css
    
    Before closing </body> tag (after Bootstrap JS):
    - jQuery 3.7.x: https://code.jquery.com/jquery-3.7.1.min.js
    - DataTables JS: https://cdn.datatables.net/2.0.0/js/dataTables.js
    - DataTables Bootstrap 5 JS: https://cdn.datatables.net/2.0.0/js/dataTables.bootstrap5.js
    
    Also add Bootstrap Icons for action buttons:
    - Bootstrap Icons CSS: https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css
    
    These will be shared across all product pages.
  </action>
  <verify>
    View source of any page with header.php, confirm all CDN links present
    Check browser console for any 404 errors on CDN resources
  </verify>
  <done>
    DataTables 2.x, jQuery 3.7.x, and Bootstrap Icons loaded via CDN in header.php, available to all pages using the header include.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build product list table with DataTables initialization</name>
  <files>products/index.php</files>
  <action>
    Update products/index.php with full product list implementation:
    
    1. Query database: SELECT * FROM products WHERE is_active = 1 ORDER BY created_at DESC
    
    2. Display flash messages (success/error from session) using display_flash_message() or inline PHP
    
    3. Create table structure with id="productsTable" class="table table-hover table-striped"
       - Table header: No, Nama Produk, Kategori, Harga, Stok, Unit, Status, Aksi
       - Loop through products and render rows
       - Format price using number_format() for Indonesian Rupiah (Rp 15.000)
       - Low stock warning: if stock <= min_stock, add text-danger class and badge "Stok Habis!" or "Stok Rendah"
       - Status badge: bg-success for active, bg-secondary for inactive
       - Actions: Edit button (btn-warning) and Delete button (btn-danger with data-bs-toggle="modal")
    
    4. Initialize DataTables with Indonesian localization:
       - language.url: '//cdn.datatables.net/plug-ins/2.0.0/i18n/id.json'
       - pageLength: 10
       - lengthMenu: [[10, 25, 50, 100], [10, 25, 50, 100]]
       - order: [[0, 'asc']]
       - columnDefs: disable sorting on Actions column
    
    5. Add "Tambah Produk" button in page header linking to create.php
  </action>
  <verify>
    Visit products/index.php, confirm:
    - Table displays all products
    - Search box works (type in search field)
    - Pagination works (click page numbers)
    - Column sorting works (click headers)
    - Low stock items show red warning
    - Prices formatted as Rp with thousand separators
  </verify>
  <done>
    Product list fully functional with DataTables features (sort, search, paginate), low stock warnings, and action buttons for each product.
  </done>
</task>

</tasks>

<verification>
- DataTables CDN resources load without errors
- Product table displays all products from database
- Search filters products by name/category
- Column sorting works on all columns except Actions
- Pagination shows 10/25/50/100 items per page
- Low stock (≤10) shows visual indicator (red text or badge)
- Edit button links to edit.php?id={product_id}
- Delete button triggers modal (modal implementation in Plan 04)
- Prices formatted in Indonesian Rupiah format
</verification>

<success_criteria>
- Admin can view all products in organized table
- Table has sorting, pagination, and search
- Low stock items clearly visible with warning indicator
- Action buttons ready for edit/delete functionality
- Indonesian localization applied to DataTables
</success_criteria>

<output>
After completion, create `.planning/phases/02-product-management/02-02-SUMMARY.md` with:
- DataTables configuration details
- Screenshot or description of table layout
- Low stock threshold confirmation (10 items)
</output>
